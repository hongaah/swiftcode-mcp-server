"use strict";var t=require("node:https"),e=require("node:http"),r=require("node:url"),o=require("node:querystring"),n=require("prettier"),s=require("node:fs"),c=require("node:child_process");function i(t){try{const e=JSON.parse(t);if("[object Object]"===Object.prototype.toString.call(e))return!0}catch(t){return!1}return!1}function a(t){try{return s.readFileSync(t,{encoding:"utf-8"})}catch(t){throw Error(`[ERROR] ${t}`)}}exports.childProcessExec=function(t,e){c.exec(t,((t,r,o)=>{t&&console.log(t.stack),console.log(r),console.log(o),e&&e()}))},exports.existsPath=function(t){try{return s.existsSync(t)}catch(t){throw Error(`[ERROR] ${t}`)}},exports.formatDocName=function(t){if("string"!=typeof t)throw Error("文件名请传入字符串格式");return t.startsWith("/")?t.slice(1):t},exports.formatPage=async function(t){const e=a(t);return await n.format(e,{filepath:t,tabWidth:2,useTabs:!1,printWidth:120,singleQuote:!0,semi:!1,trailingComma:"none",bracketSameLine:!0,endOfLine:"lf",htmlWhitespaceSensitivity:"css",vueIndentScriptAndStyle:!0})},exports.generateFile=function(t,e,r=!1){try{s.writeFileSync(t,e),!r&&t.startsWith("temp")||console.log(`[SUCCESS] 创建 ${t} 文件成功`)}catch(t){throw Error(`[ERROR] ${t}`)}},exports.generateFolder=function(t,e,r=!1){try{s.existsSync(t)||(s.mkdirSync(t),!r&&t.startsWith("temp")||console.log(`[SUCCESS] 创建 ${t} 文件夹成功`)),e&&e()}catch(e){throw Error(`[ERROR] 创建 ${t} 文件夹失败`)}},exports.hump2Line=function(t){if(!t)return"";const e=t.replace(/([A-Z])/g,"-$1").toLowerCase();return e.startsWith("-")?e.slice(1):e},exports.isJson=i,exports.json2moduleContent=function(t,e="data"){return`const ${e} = ${JSON.stringify(t,void 0,2)};\n\nexport { ${e} }`},exports.map2obj=function(t){const e=Object.create(null);for(let[r,o]of t)e[r]=o;return e},exports.readFile=a,exports.removeDir=function t(e){if(s.existsSync(e)){s.readdirSync(e).forEach((r=>{const o=`${e}/${r}`;s.statSync(o).isDirectory()?t(o):s.unlinkSync(o)})),s.rmdirSync(e)}},exports.removeFile=function(t,e=!1){const r=t.startsWith("/")?t.slice(1):t;s.unlink(t,(t=>{if(t)throw Error(t.message);e&&console.log(`${r} 文件已删除`)}))},exports.request=async function(n){try{return await function(n){const{url:s,method:c="get",data:a={},headers:u={}}=n,l=r.urlToHttpOptions(new URL(s)),p=o.stringify(a),h="https:"===l.protocol?t.request:e.request,d={...l,method:c,headers:u};return"[object Object]"===Object.prototype.toString.call(a)&&Object.values(a).length&&Object.assign(d,{search:p}),new Promise(((t,e)=>{const r=h(d,(r=>{r.setEncoding("utf8");let o="";r.on("data",(t=>o+=t)),r.on("end",(()=>{200===r.statusCode&&t(i(o)?JSON.parse(o):o),404===r.statusCode&&e("404 找不到请求的资源");const n=i(o)?JSON.parse(o):o;"[object Object]"===Object.prototype.toString.call(n)&&Object.values(n).length&&e(n.message||n),e(o)}))}));"post"===c&&r.write(p),r.on("error",(t=>{e(t)})),r.end()}))}(n)}catch(t){throw Error(`${(null==t?void 0:t.message)?t.message:t}`)}};
